REM  *****  BASIC  *****

Sub Main

	dim document as object
	dim sheet as object
	dim maxRowNum as integer
	
	rem-- Kullanılan dosyadaki sayfa adı Sheet1 olmalıdır.
	document=ThisComponent
	sheet=document.Sheets.getByIndex(0)
	
	sheet.unprotect("193782")
	
	saveCustomer(sheet)
	maxRowNum = getMaxRowNum(sheet)
	maxRowNum = removeEmptyCells(sheet, maxRowNum)
	addDateIfNeeded(sheet, maxRowNum)
	arrangeTotalCell(sheet)
	
	sheet.protect("193782")

End Sub

function removeEmptyCells(sheet as object, maxRowNum as integer) 
	dim priceCell as object
	for i = 2 to maxRowNum
		priceCell = sheet.getCellByPosition(1, i)
		if Len(priceCell.getString()) = 0 then
			sheet.rows.removeByIndex(i, 1)
			i = i - 1
			maxRowNum = maxRowNum - 1
		end if
	next i
	removeEmptyCells = maxRowNum
end function

function getMaxRowNum(sheet as object)
	dim priceCell as object
	dim dateCell as object
	maxRowNum = 500
	priceCell = sheet.getCellByPosition(1, maxRowNum) 
	dateCell = sheet.getCellByPosition(0, maxRowNum)
	while Len(priceCell.getString()) = 0 and Len(dateCell.getString()) = 0
		maxRowNum = maxRowNum - 1
		dateCell = sheet.getCellByPosition(0, maxRowNum)
		priceCell = sheet.getCellByPosition(1, maxRowNum)
	wend
	getMaxRowNum = maxRowNum
end function

function addDateIfNeeded(sheet as object, maxRowNum as integer)
	dim priceCell as object
	dim dateCell as object
	for i = 2 to maxRowNum
		dateCell = sheet.getCellByPosition(0, i)
		priceCell = sheet.getCellByPosition(1, i)
		if Len(priceCell.getString()) > 0 and Len(dateCell.getString()) = 0 then
			dateCell.setValue(Now())
			priceCell.CellBackColor = RGB(30, 255, 86)
		end if
	next i
end function

function arrangeTotalCell(sheet as object)
	dim totalCell as object
	totalCell = sheet.getCellByPosition(3, 2)
	totalCell.setFormula("=SUM(B2:B9999)")
end function

function saveCustomer(sheet as object) 
	dim customerName as string
	dim customerCell as object	
	customerCell = sheet.getCellByPosition(0,0)
	customerName = InputBox("Müşteri adını girin: ")
	customerName = LCase(customerName)
	customerCell.setString(UCase(customer))
end function

